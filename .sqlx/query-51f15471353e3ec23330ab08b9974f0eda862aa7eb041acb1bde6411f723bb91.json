{
  "db_name": "PostgreSQL",
  "query": "\n            UPDATE peer_connections SET\n                shared_artifacts_count = (\n                    SELECT COUNT(DISTINCT ec1.artifact_id)\n                    FROM edge_cache_entries ec1\n                    JOIN edge_cache_entries ec2\n                        ON ec1.artifact_id = ec2.artifact_id\n                    WHERE ec1.edge_node_id = $1 AND ec2.edge_node_id = $2\n                ),\n                shared_chunks_count = (\n                    SELECT COALESCE(SUM(\n                        LEAST(ca1.available_chunks, ca2.available_chunks)\n                    ), 0)\n                    FROM chunk_availability ca1\n                    JOIN chunk_availability ca2\n                        ON ca1.artifact_id = ca2.artifact_id\n                    WHERE ca1.edge_node_id = $1 AND ca2.edge_node_id = $2\n                ),\n                updated_at = NOW()\n            WHERE source_node_id = $1 AND target_node_id = $2\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Uuid",
        "Uuid"
      ]
    },
    "nullable": []
  },
  "hash": "51f15471353e3ec23330ab08b9974f0eda862aa7eb041acb1bde6411f723bb91"
}
